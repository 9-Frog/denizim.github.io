<div id="tarot-app"></div>

<style>
  /* Arka plan: toz pembe */
  html, body { background:#f9d5d3; margin:0; padding:0; }
  #tarot-app {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    max-width: 960px; margin: 28px auto; padding: 20px;
    background: rgba(255,255,255,0.9); border-radius: 16px;
    box-shadow: 0 10px 24px rgba(0,0,0,.12); backdrop-filter: blur(4px);
  }
  h1 { margin:0 0 12px; font-size:24px; color:#222; }
  .muted { color:#555; font-size:14px; }
  .section{ margin-top:14px; }

  .row { display:grid; gap:10px; grid-template-columns: 1fr; }
  @media (min-width:700px){ .row-2 { grid-template-columns: 1fr 1fr; } }

  input, select, textarea {
    width:100%; padding:12px 14px; font-size:15px;
    border:1px solid #ddd; border-radius:12px; background:#fff;
    box-shadow: inset 0 1px 2px rgba(0,0,0,.05);
    outline:none;
  }
  textarea { min-height:88px; resize:vertical; }

  .btn {
    display:inline-flex; align-items:center; justify-content:center;
    padding:10px 16px; border:none; border-radius:12px;
    background:#111; color:#fff; font-weight:700; cursor:pointer;
    transition:.15s transform, .2s box-shadow, .2s background;
  }
  .btn:hover { transform: translateY(-1px); }
  .btn[disabled]{ opacity:.5; cursor:not-allowed; }

  .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#eef2ff; color:#3b49df; font-size:12px; font-weight:700; }

  .decks { display:grid; grid-template-columns: repeat(auto-fit, minmax(120px,1fr)); gap:12px; margin-top:12px; }
  .deck {
    background:#fff; border:1px solid #eee; border-radius:14px; padding:18px; text-align:center;
    box-shadow:0 4px 12px rgba(0,0,0,.08); cursor:pointer; transition:.16s transform,.2s box-shadow;
  }
  .deck:hover { transform: translateY(-2px); box-shadow: 0 8px 22px rgba(0,0,0,.12); }

  .cards { display:grid; grid-template-columns: repeat(auto-fit,minmax(100px,1fr)); gap:12px; margin-top:12px; }

  /* Basit & saƒülam flip: arka/√∂n opaklƒ±kla deƒüi≈üir */
  .card {
    position:relative; aspect-ratio:2/3; border-radius:12px; overflow:hidden;
    cursor:pointer; border:1px solid #e9e9e9; background:#eee; 
    box-shadow:0 6px 16px rgba(0,0,0,.1);
  }
  .face, .back {
    position:absolute; inset:0; border-radius:12px; transition: opacity .35s ease;
  }
  .back { opacity:1; background-size:cover; background-position:center; background-repeat:no-repeat; }
  .face { opacity:0; }
  .card.flipped .back { opacity:0; }
  .card.flipped .face { opacity:1; }

  /* √ñN Y√úZ: tam sƒ±ƒüsƒ±n, ta≈ümasƒ±n */
  .face img {
    width:100%; height:100%; object-fit:contain; object-position:center; display:block; border-radius:12px;
    background:#fff; /* varsa transparan kƒ±sƒ±mlar beyaz dursun */
  }

  .sel-badge { position:absolute; bottom:6px; left:6px; background:#111; color:#fff; font-size:11px; font-weight:700; padding:4px 8px; border-radius:8px; }

  .reading { margin-top:16px; padding:16px; background:#fff; border:1px solid #eee; border-radius:16px; box-shadow:0 6px 16px rgba(0,0,0,.08); }
  .reading .item { background:#fdf1f1; border:1px solid #fde1e1; border-radius:12px; padding:12px; margin-top:10px; }
  .meta { color:#666; font-size:12px; margin-bottom:6px; }

  /* Final g√∂r√ºn√ºm grid'i */
  .final-grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap:14px; margin-top:12px; }
  .final-card {
    border:1px solid #eee; border-radius:14px; overflow:hidden; background:#fff; box-shadow:0 4px 12px rgba(0,0,0,.08);
  }
  .final-card .img { aspect-ratio:2/3; background:#fafafa; }
  .final-card .img img { width:100%; height:100%; object-fit:contain; display:block; background:#fff; }
  .final-card .cap { padding:8px 10px; font-size:13px; color:#444; }
</style>

<script>
(function(){
  // === G√∂rsel linkleri ===
  const CARD_BACK_IMAGE_URL = "https://steve-p.org/cards/pix/RWSa-X-BA.png"; // kendi arka linkinle deƒüi≈ütirilebilir

  const CARD_IMAGES = {
    // Major Arcana
    "The Fool": "https://steve-p.org/cards/pix/RWSa-T-00.png",
    "The Magician": "https://steve-p.org/cards/pix/RWSa-T-01.png",
    "The High Priestess": "https://steve-p.org/cards/pix/RWSa-T-02.png",
    "The Empress": "https://steve-p.org/cards/pix/RWSa-T-03.png",
    "The Emperor": "https://steve-p.org/cards/pix/RWSa-T-04.png",
    "The Hierophant": "https://steve-p.org/cards/pix/RWSa-T-05.png",
    "The Lovers": "https://steve-p.org/cards/pix/RWSa-T-06.png",
    "The Chariot": "https://steve-p.org/cards/pix/RWSa-T-07.png",
    "Strength": "https://steve-p.org/cards/pix/RWSa-T-08.png",
    "The Hermit": "https://steve-p.org/cards/pix/RWSa-T-09.png",
    "Wheel of Fortune": "https://steve-p.org/cards/pix/RWSa-T-10.png",
    "Justice": "https://steve-p.org/cards/pix/RWSa-T-11.png",
    "The Hanged Man": "https://steve-p.org/cards/pix/RWSa-T-12.png",
    "Death": "https://steve-p.org/cards/pix/RWSa-T-13.png",
    "Temperance": "https://steve-p.org/cards/pix/RWSa-T-14.png",
    "The Devil": "https://steve-p.org/cards/pix/RWSa-T-15.png",
    "The Tower": "https://steve-p.org/cards/pix/RWSa-T-16.png",
    "The Star": "https://steve-p.org/cards/pix/RWSa-T-17.png",
    "The Moon": "https://steve-p.org/cards/pix/RWSa-T-18.png",
    "The Sun": "https://steve-p.org/cards/pix/RWSa-T-19.png",
    "Judgement": "https://steve-p.org/cards/pix/RWSa-T-20.png",
    "The World": "https://steve-p.org/cards/pix/RWSa-T-21.png",

    // Wands
    "Ace of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-0A.webp",
    "Two of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-02.webp",
    "Three of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-03.webp",
    "Four of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-04.webp",
    "Five of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-05.webp",
    "Six of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-06.webp",
    "Seven of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-07.webp",
    "Eight of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-08.webp",
    "Nine of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-09.webp",
    "Ten of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-10.webp",
    "Page of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-J1.webp",
    "Knight of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-J2.webp",
    "Queen of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-QU.webp",
    "King of Wands": "https://steve-p.org/cards/small/sm_RWSa-W-KI.webp",

    // Cups
    "Ace of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-0A.webp",
    "Two of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-02.webp",
    "Three of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-03.webp",
    "Four of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-04.webp",
    "Five of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-05.webp",
    "Six of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-06.webp",
    "Seven of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-07.webp",
    "Eight of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-08.webp",
    "Nine of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-09.webp",
    "Ten of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-10.webp",
    "Page of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-J1.webp",
    "Knight of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-J2.webp",
    "Queen of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-QU.webp",
    "King of Cups": "https://steve-p.org/cards/small/sm_RWSa-C-KI.webp",

    // Swords
    "Ace of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-0A.webp",
    "Two of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-02.webp",
    "Three of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-03.webp",
    "Four of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-04.webp",
    "Five of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-05.webp",
    "Six of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-06.webp",
    "Seven of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-07.webp",
    "Eight of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-08.webp",
    "Nine of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-09.webp",
    "Ten of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-10.webp",
    "Page of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-J1.webp",
    "Knight of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-J2.webp",
    "Queen of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-QU.webp",
    "King of Swords": "https://steve-p.org/cards/small/sm_RWSa-S-KI.webp",

    // Pentacles
    "Ace of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-0A.png",
    "Two of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-02.png",
    "Three of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-03.png",
    "Four of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-04.png",
    "Five of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-05.png",
    "Six of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-06.png",
    "Seven of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-07.png",
    "Eight of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-08.png",
    "Nine of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-09.png",
    "Ten of Pentacles": "https://steve-p.org/cards/pix/RWSa-P-10.png",
    "Page of Pentacles": "https://steve-p.org/cards/small/sm_RWSa-P-J1.webp",
    "Knight of Pentacles": "https://steve-p.org/cards/small/sm_RWSa-P-J2.webp",
    "Queen of Pentacles": "https://steve-p.org/cards/small/sm_RWSa-P-QU.webp",
    "King of Pentacles": "https://steve-p.org/cards/small/sm_RWSa-P-KI.webp"
  };

  // ‚Äî‚Äî‚Äî Arka plan i√ßin varsayƒ±lan pembe desen (arka URL bo≈ü/√ß√∂kerse) ‚Äî‚Äî‚Äî
  const DEFAULT_BACK = `data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 450'>
  <defs>
    <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
      <stop offset='0%' stop-color='#f9d5d3'/>
      <stop offset='100%' stop-color='#fbe8e6'/>
    </linearGradient>
    <pattern id='p' width='20' height='20' patternUnits='userSpaceOnUse'>
      <circle cx='10' cy='10' r='2' fill='#f3b6b3' opacity='0.6'/>
    </pattern>
  </defs>
  <rect width='100%' height='100%' fill='url(#g)'/>
  <rect width='100%' height='100%' fill='url(#p)'/>
</svg>`;

  const backUrl = () => (CARD_BACK_IMAGE_URL && CARD_BACK_IMAGE_URL.trim()) ? CARD_BACK_IMAGE_URL : DEFAULT_BACK;
  const faceUrlFor = (cardName) => {
    const u = CARD_IMAGES[cardName];
    return (u && typeof u === 'string' && u.trim()) ? u : backUrl();
  };

  // === Tarot verileri ===
  const MAJOR = [
    'The Fool','The Magician','The High Priestess','The Empress','The Emperor','The Hierophant',
    'The Lovers','The Chariot','Strength','The Hermit','Wheel of Fortune','Justice','The Hanged Man',
    'Death','Temperance','The Devil','The Tower','The Star','The Moon','The Sun','Judgement','The World'
  ];
  const SUITS = ['Wands','Cups','Swords','Pentacles'];
  const RANKS = ['Ace','Two','Three','Four','Five','Six','Seven','Eight','Nine','Ten','Page','Knight','Queen','King'];
  const MINOR = SUITS.flatMap(suit => RANKS.map(rank => `${rank} of ${suit}`));
  const ALL_CARDS = [...MAJOR, ...MINOR].map((name,idx)=>({id:idx,name}));

  // Evet/Hayƒ±r (tek kart)
  const YESNO = { "The Sun":"yes","The Lovers":"yes","The World":"yes","The Tower":"no","Death":"no","The Devil":"no" };
  const suitOf = n => SUITS.find(s=>n.includes(` of ${s}`));
  const defaultYesNo = n => suitOf(n)==="Swords"?"no": suitOf(n)==="Cups"?"maybe":"yes";

  // Pozisyon etiketleri
  const positions = {
    three: ['Ge√ßmi≈ü','≈ûimdi','Gelecek'],
    five: ['Ge√ßmi≈ü','≈ûimdi','Gizli Etkiler','Engeller/Zorluklar','Gelecek'],
    cross: ['≈ûimdiki Durum','Engeller/Zorluklar','Bilin√ßli Farkƒ±ndalƒ±k','Bilin√ßaltƒ±/Temel','Ge√ßmi≈ü','Gelecek','Sen','Kar≈üƒ± Taraf','Umutlar/Korkular','Sonu√ß'],
    relationship: ['Senin Duygularƒ±n','Onun Duygularƒ±','Senin D√º≈ü√ºncelerin','Onun D√º≈ü√ºnceleri','Aranƒ±zdaki Baƒü','Engeller/Sorunlar','Gelecek Olasƒ± Sonu√ß']
  };

  // === State ===
  const state = {
    name: "", mode: null, category: null, yesnoQuestion: "",
    decksMeta: null, chosenDeckIndex: null, needSelect: 0, selectedCards: []
  };

  const root = document.getElementById('tarot-app');
  render();

  function render(){
    // Eƒüer se√ßim tamamlandƒ±ysa sadece final g√∂r√ºn√ºm
    if (state.selectedCards.length && state.selectedCards.length === state.needSelect) {
      return renderFinal();
    }

    root.innerHTML = `
      <h1>üîÆ Online Tarot</h1>
      <div class="muted">ƒ∞smini yaz, a√ßƒ±lƒ±m t√ºr√ºn√º se√ß; Tek Kart‚Äôta evet/hayƒ±r sorunu gir. Diƒüer a√ßƒ±lƒ±mlarda kategori se√ßmeyi unutma.</div>
    `;

    // STEP 1
    const step1 = document.createElement('div'); step1.className='section';
    step1.innerHTML = `
      <div class="row row-2">
        <div>
          <label class="muted">ƒ∞smin</label>
          <input id="inp-name" type="text" placeholder="ƒ∞smini yaz" value="${escapeHtml(state.name)}">
        </div>
        <div>
          <label class="muted">A√ßƒ±lƒ±m T√ºr√º</label>
          <select id="sel-mode">
            <option value="">Se√ßiniz‚Ä¶</option>
            <option value="one" ${state.mode==='one'?'selected':''}>Tek Kart</option>
            <option value="three" ${state.mode==='three'?'selected':''}>3 Kart</option>
            <option value="five" ${state.mode==='five'?'selected':''}>5 Kart</option>
            <option value="cross" ${state.mode==='cross'?'selected':''}>Ha√ß A√ßƒ±lƒ±mƒ±</option>
            <option value="relationship" ${state.mode==='relationship'?'selected':''}>ƒ∞li≈üki A√ßƒ±lƒ±mƒ±</option>
          </select>
        </div>
      </div>
    `;
    root.appendChild(step1);

    // STEP 2
    if(state.mode === 'one'){
      const step2 = document.createElement('div'); step2.className='section';
      step2.innerHTML = `
        <label class="muted">Evet / Hayƒ±r Sorun</label>
        <textarea id="inp-yn" placeholder="√ñrn: Bug√ºnk√º g√∂r√º≈ümem olumlu ge√ßer mi?">${escapeHtml(state.yesnoQuestion)}</textarea>
      `;
      root.appendChild(step2);
    } else if(state.mode){
      const step2 = document.createElement('div'); step2.className='section';
      step2.innerHTML = `
        <label class="muted">Kategori</label>
        <select id="sel-cat">
          <option value="">Se√ßiniz‚Ä¶</option>
          <option value="A≈ük" ${state.category==='A≈ük'?'selected':''}>A≈ük</option>
          <option value="Kariyer/Para" ${state.category==='Kariyer/Para'?'selected':''}>Kariyer/Para</option>
          <option value="Genel Durum" ${state.category==='Genel Durum'?'selected':''}>Genel Durum</option>
        </select>
      `;
      root.appendChild(step2);
    }

    // STEP 3
    const canBuild = state.name && state.mode && (state.mode==='one' || !!state.category);
    const step3 = document.createElement('div'); step3.className='section';
    step3.innerHTML = `
      <button id="btn-decks" class="btn" ${!canBuild?'disabled':''}>Desteleri Olu≈ütur</button>
      ${state.decksMeta ? '<span class="pill" style="margin-left:8px;">Hazƒ±r</span>':''}
    `;
    root.appendChild(step3);

    // STEP 4
    if(state.decksMeta){
      if(state.chosenDeckIndex === null){
        const decksWrap = document.createElement('div'); decksWrap.className='section';
        decksWrap.innerHTML = `<div class="decks"></div>`;
        const decksEl = decksWrap.querySelector('.decks');

        state.decksMeta.decks.forEach((deck, i)=>{
          const d = document.createElement('div'); d.className='deck';
          d.innerHTML = `üÉè Deste ${i+1}<div class="muted">${deck.length} kart</div>`;
          d.addEventListener('click', ()=>{
            state.chosenDeckIndex = i;
            state.needSelect = requiredCount(state.mode);
            state.selectedCards = [];
            render();
          });
          decksEl.appendChild(d);
        });
        root.appendChild(decksWrap);
      } else {
        const deck = state.decksMeta.decks[state.chosenDeckIndex];
        const picked = state.selectedCards.length;
        const cardsWrap = document.createElement('div'); cardsWrap.className='section';
        cardsWrap.innerHTML = `
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
            <span class="pill">Deste ${state.chosenDeckIndex+1}</span>
            <span class="muted">Se√ßilecek: <b>${state.needSelect}</b> ‚Ä¢ Se√ßilen: <b>${picked}</b></span>
            <div style="flex:1"></div>
            <button id="btn-change-deck" class="btn" style="background:#555">Desteyi Deƒüi≈ütir</button>
          </div>
          <div class="cards" id="cards-grid"></div>
        `;
        root.appendChild(cardsWrap);

        const grid = cardsWrap.querySelector('#cards-grid');
        deck.forEach(cardId=>{
          const cardData = ALL_CARDS[cardId];
          const c = document.createElement('div'); 
          c.className='card'; 
          c.setAttribute('role','button');

          // BACK (CSS background)
          const back = document.createElement('div'); 
          back.className='back'; 
          back.style.backgroundImage = `url('${backUrl()}')`;

          // FACE (<img> + fallback)
          const face = document.createElement('div'); 
          face.className='face';
          const faceImg = document.createElement('img');
          faceImg.alt = cardData.name;
          faceImg.decoding = 'async';
          faceImg.loading = 'lazy';
          faceImg.referrerPolicy = 'no-referrer';
          faceImg.src = faceUrlFor(cardData.name);
          faceImg.onerror = () => { faceImg.src = backUrl(); };
          face.appendChild(faceImg);

          c.appendChild(back); 
          c.appendChild(face);

          c.addEventListener('click', ()=>{
            if(c.classList.contains('flipped')) return;
            if(state.selectedCards.length >= state.needSelect) return;
            c.classList.add('flipped');
            c.insertAdjacentHTML('beforeend', `<div class="sel-badge">#${state.selectedCards.length+1}</div>`);
            state.selectedCards.push({ id: cardId, name: cardData.name });
            if(state.selectedCards.length === state.needSelect){
              setTimeout(render, 380);
            }
          });
          grid.appendChild(c);
        });

        cardsWrap.querySelector('#btn-change-deck').addEventListener('click', ()=>{
          state.chosenDeckIndex = null;
          state.selectedCards = [];
          render();
        });
      }
    }

    // Events
    const nameEl = document.getElementById('inp-name');
    const modeEl = document.getElementById('sel-mode');
    const catEl  = document.getElementById('sel-cat');
    const ynEl   = document.getElementById('inp-yn');
    const decksBtn = document.getElementById('btn-decks');

    if(nameEl) nameEl.addEventListener('input', e=>{ state.name = e.target.value.trim(); });
    if(modeEl) modeEl.addEventListener('change', e=>{
      state.mode = e.target.value || null;
      state.category = null; state.yesnoQuestion=''; state.decksMeta=null; state.chosenDeckIndex=null; state.selectedCards=[]; state.needSelect=0;
      render();
    });
    if(catEl) catEl.addEventListener('change', e=>{ state.category = e.target.value || null; render(); });
    if(ynEl) ynEl.addEventListener('input', e=>{ state.yesnoQuestion = e.target.value; });

    if(decksBtn) decksBtn.addEventListener('click', ()=>{
      if(!canBuildNow()) return;
      state.decksMeta = buildDecks(state.mode);
      state.chosenDeckIndex = null; state.selectedCards=[]; state.needSelect = requiredCount(state.mode);
      render();
    });

    function canBuildNow(){
      return state.name && state.mode && (state.mode==='one' || !!state.category);
    }
  }

  // === Final g√∂r√ºn√ºm ===
  function renderFinal(){
    const pos = positions[state.mode] || [];
    const title = state.mode==='one' ? 'Tek Kart' :
                  state.mode==='three' ? '3 Kart' :
                  state.mode==='five' ? '5 Kart' :
                  state.mode==='cross' ? 'Ha√ß A√ßƒ±lƒ±mƒ±' : 'ƒ∞li≈üki A√ßƒ±lƒ±mƒ±';

    const header = `
      <h1>üîÆ Online Tarot ‚Ä¢ ${title}</h1>
      <div class="muted">${escapeHtml(state.name)}${state.category ? ' ‚Ä¢ Kategori: '+escapeHtml(state.category): ''}</div>
    `;

    const gridCards = state.selectedCards.map((c,i)=>`
      <div class="final-card">
        <div class="img"><img src="${faceUrlFor(c.name)}" alt="${escapeHtml(c.name)}" referrerpolicy="no-referrer" onerror="this.src='${backUrl()}'"></div>
        <div class="cap"><b>${pos[i] ? pos[i]+': ' : ''}${escapeHtml(c.name)}</b></div>
      </div>
    `).join('');

    // Yorumlar
    let readingHtml = '';
    if(state.mode === 'one'){
      const c = state.selectedCards[0];
      const yn = (YESNO[c.name] || defaultYesNo(c.name)).toUpperCase();
      readingHtml += `
        <div class="item">
          <div class="meta">Soru: <b>${escapeHtml(state.yesnoQuestion||'‚Äî')}</b> ‚Ä¢ Yanƒ±t eƒüilimi: <b>${yn}</b></div>
          ${interpretCard(c.name, state.category, 'Tek Kart')}
        </div>`;
    } else {
      state.selectedCards.forEach((c,i)=>{
        readingHtml += `
          <div class="item">
            <div class="meta">${pos[i]||('Kart '+(i+1))}</div>
            <b>${escapeHtml(c.name)}</b>
            <div style="margin-top:6px;">${interpretCard(c.name, state.category, pos[i]||null)}</div>
          </div>`;
      });
    }

    root.innerHTML = `
      ${header}
      <div class="final-grid">${gridCards}</div>
      <div class="reading">
        <h3>üßø Yorum</h3>
        ${readingHtml}
        <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
          <button class="btn" id="btn-again">Yeniden Dene</button>
        </div>
      </div>
    `;

    document.getElementById('btn-again').addEventListener('click', ()=>{
      resetAll(); render();
    });
  }

  // === Yorum √ºretici ===
  function interpretCard(name, category, posLabel){
    // Kƒ±sa anlam s√∂zl√ºkleri (√∂zet)
    const major = {
      "The Fool": "yeni ba≈ülangƒ±√ß, risk alma, akƒ±≈üa g√ºven.",
      "The Magician": "irade, odak, fƒ±rsatƒ± deƒüerlendirme.",
      "The High Priestess": "i√ßg√∂r√º, sezgi, sƒ±rlar.",
      "The Empress": "bereket, bakƒ±m, yaratƒ±m.",
      "The Emperor": "d√ºzen, otorite, strateji.",
      "The Hierophant": "gelenek, eƒüitim, rehberlik.",
      "The Lovers": "uyum, se√ßim, deƒüerlerle hizalanma.",
      "The Chariot": "kontrol, kararlƒ±lƒ±k, ilerleme.",
      "Strength": "sakin g√º√ß, cesaret, ≈üefkatle y√∂netim.",
      "The Hermit": "i√ße d√∂n√º≈ü, bilgelik, sabƒ±r.",
      "Wheel of Fortune": "d√∂n√ºm noktasƒ±, talih, d√∂ng√º.",
      "Justice": "denge, hakkaniyet, net karar.",
      "The Hanged Man": "bakƒ±≈ü a√ßƒ±sƒ± deƒüi≈üimi, teslimiyet.",
      "Death": "bitiri≈ü ve d√∂n√º≈ü√ºm, yenilenme.",
      "Temperance": "itidal, uyum, orta yol.",
      "The Devil": "baƒüƒ±mlƒ±lƒ±k, baƒülanma, farkƒ±ndalƒ±k ihtiyacƒ±.",
      "The Tower": "ani sarsƒ±ntƒ±, ger√ßeƒüin ortaya √ßƒ±kƒ±≈üƒ±.",
      "The Star": "umut, ≈üifa, y√∂n√ºn√º bulma.",
      "The Moon": "belirsizlik, hayal/kuruntu, sezgi.",
      "The Sun": "netlik, canlƒ±lƒ±k, ba≈üarƒ±.",
      "Judgement": "uyanƒ±≈ü, hesapla≈üma, ikinci ≈üans.",
      "The World": "tamamlanma, ustalƒ±k, b√ºt√ºnl√ºk."
    };

    const suitKeywords = {
      Wands: "enerji, motivasyon, giri≈üim",
      Cups: "duygu, baƒü, sezgi",
      Swords: "zihin, karar, ileti≈üim",
      Pentacles: "madde, i≈ü, saƒülƒ±k/para"
    };
    const rankKeywords = {
      Ace: "tohum, fƒ±rsat, ba≈ülangƒ±√ß",
      Two: "ikilem, plan, ilk denge",
      Three: "i≈übirliƒüi, ilk sonu√ßlar",
      Four: "stabilite, kutlama/koruma",
      Five: "zorluk, kayƒ±p, rekabet",
      Six: "ilerleme, payla≈üƒ±m, destek",
      Seven: "sƒ±nav, sabƒ±r, savunma",
      Eight: "yoƒüun emek, hareket",
      Nine: "dayanƒ±klƒ±lƒ±k, tatmin, endi≈üe",
      Ten: "tamamlanma, y√ºk, aile/b√ºt√ºnl√ºk",
      Page: "√∂ƒürenme, merak, haber",
      Knight: "hareket, arayƒ±≈ü, tempo",
      Queen: "olgun sezgi/beceri, nurt√ºr",
      King: "ustalƒ±k, liderlik, yapƒ±"
    };

    // Kart tipini √ß√∂z
    let base = "";
    if (major[name]) {
      base = major[name];
    } else {
      const m = name.match(/^(Ace|Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten|Page|Knight|Queen|King) of (Wands|Cups|Swords|Pentacles)$/);
      if (m) {
        base = `${rankKeywords[m[1]]}; ${m[2]}: ${suitKeywords[m[2]]}.`;
      } else {
        base = "√∂z, y√∂n ve dersleri hatƒ±rlatƒ±r.";
      }
    }

    // Kategori lensi
    const lens = (category=>{
      if(category==="A≈ük") return "ƒ∞li≈ükiler ve duygusal baƒü a√ßƒ±sƒ±ndan";
      if(category==="Kariyer/Para") return "Kariyer ve maddi konular a√ßƒ±sƒ±ndan";
      if(category==="Genel Durum") return "Genel ya≈üam akƒ±≈üƒ± a√ßƒ±sƒ±ndan";
      return "Genel yorum olarak";
    })(category);

    // Pozisyona g√∂re ek vurgu
    const posHint = posLabel ? ` (${posLabel.toLowerCase()} etkisi)` : "";

    // Orta uzunlukta 2‚Äì3 c√ºmle √ºret
    const tipsBySuit = {
      Wands: "Adƒ±m at; enerjini tek bir hedefe odaklarsan ilerleme hƒ±zlanƒ±r.",
      Cups: "Kalbini a√ßƒ±k tut; a√ßƒ±k ileti≈üim yanlƒ±≈ü anlamalarƒ± √ß√∂zer.",
      Swords: "Ger√ßekleri netle≈ütir; berrak bir plan gerginliƒüi azaltƒ±r.",
      Pentacles: "K√º√ß√ºk ama d√ºzenli emek b√ºy√ºk birikim yaratƒ±r."
    };
    let suit = name.includes(" of ") ? name.split(" of ")[1] : null;
    let tip = suit ? tipsBySuit[suit] : "Sabƒ±rlƒ± ve tutarlƒ± davranƒ±≈ü sonucu g√º√ßlendirir.";

    // √ñzel bazƒ± kartlara minik y√∂nlendirme
    const special = {
      "The Tower": "Sarsƒ±ntƒ± ge√ßicidir; daƒüƒ±lan yapƒ± yerine daha saƒülamƒ±nƒ± kuracaksƒ±n.",
      "The Devil": "Baƒülayan kalƒ±plarƒ± fark edip k√º√ß√ºk bir √∂zg√ºrle≈üme adƒ±mƒ± at.",
      "The Sun": "G√ºvenle g√∂r√ºn√ºr ol; ba≈üarƒ± i√ßin zaman doƒüru.",
      "The Star": "Kendine ≈üefkat g√∂ster; i√ß sesin y√∂n√ºn√º aydƒ±nlatƒ±yor.",
      "Wheel of Fortune": "Deƒüi≈üimden korkma; dalgayla uyumlu hareket et."
    };
    const extra = special[name] ? ` ${special[name]}` : "";

    return `${lens}${posHint}: ${base} ${tip}.${extra}`;
  }

  // === Helpers ===
  function buildDecks(mode){
    const shuffled = shuffle(ALL_CARDS.map(c=>c.id));
    let decksCount = 6, size = 13;
    if(mode==='cross'){ decksCount=3; size=26; }
    const decks = [];
    let i=0;
    for(let d=0; d<decksCount; d++){
      decks.push(shuffled.slice(i, i+size)); i+=size;
    }
    return { count: decksCount, size, decks };
  }
  function requiredCount(m){
    if(m==='one') return 1;
    if(m==='three') return 3;
    if(m==='five') return 5;
    if(m==='cross') return 10;
    if(m==='relationship') return 7;
    return 1;
  }
  function label(m){
    return m==='one'?'Tek Kart': m==='three'?'3 Kart': m==='five'?'5 Kart': m==='cross'?'Ha√ß A√ßƒ±lƒ±mƒ±':'ƒ∞li≈üki A√ßƒ±lƒ±mƒ±';
  }
  function shuffle(arr){ const a=[...arr]; for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
  function escapeHtml(s=''){ return s.replace(/[&<>"']/g, ch=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[ch])); }
  function resetAll(){ state.name=''; state.mode=null; state.category=null; state.yesnoQuestion=''; state.decksMeta=null; state.chosenDeckIndex=null; state.selectedCards=[]; state.needSelect=0; }
})();
</script>
